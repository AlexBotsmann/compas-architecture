<!--
SPDX-FileCopyrightText: 2021 Alliander N.V.

SPDX-License-Identifier: CC-BY-4.0
-->

## Архітектура для мапингуя CIM - IEC 61850.

Щоб зробити мапинг, нам потрібен якийсь інструмент обробки XML для обробки вхідних/вихідних XML-файлів.

### Що воно повинно робити?
- Маніпулювання XML-файлами
- Можна використовувати в мові програмування Java
- Відсутність використання додаткової бібліотеки (це профіт)
- Ефективне використання пам'яті (через вимогу до запуску локально або в хмарі)
- Обробка форматів RDF (оскільки можна зробити припущення, що всі вхідні CIM-файли використовують фреймворк RDF)

### Знайдені варіанти
В Java існує в основному 4 визначення API для підтримки XML:
- SAX
- DOM
- StAX
- JAXB

У кожного з них є свої плюси і мінуси:

|                          | SAX                                 | DOM                                 | StAX                                | JAXB                                |
| :----------------------- | :---------------------------------- | :---------------------------------- | :---------------------------------- | :---------------------------------- |
| Єфективна пам'ять         | <span style="color:green">Ok</span> | <span style="color:red">No</span>   | <span style="color:green">Ok</span> | <span style="color:green">Ok</span> |
| Двонаправлена навігація | <span style="color:red">No</span>   | <span style="color:green">Ok</span> | <span style="color:red">No</span>   | <span style="color:green">Ok</span> |
| Маніпуляції з XML        | <span style="color:red">No</span>   | <span style="color:green">Ok</span> | <span style="color:red">No</span>   | <span style="color:green">Ok</span> |
| Прив'язка даних           | <span style="color:red">No</span>   | <span style="color:red">No</span>   | <span style="color:red">No</span>   | <span style="color:green">Ok</span> |

Джелело: Baeldung.com

Згідно з цією таблицею, у нас залишилося 2 варіанти, якщо ми хочемо маніпулювати конфігураційними файлами XML: DOM і JAXB. Враховуючи той факт, що ефективне використання пам'яті є перевагою, JAXB буде ідеальним варіантом для обробки XML!

### Вхідні CIM-файли
Через припущення, що всі вхідні CIM-файли використовують фреймворк RDF, нерозумно використовувати JAXB для вхідних CIM-файлів. Якщо ми це зробимо, ми винайдемо велосипед. Існують інші бібліотеки для роботи з такими типами RDF-файлів.
[RDF4J](https://rdf4j.org/) і [Apache Jena](https://jena.apache.org/) найбільш використовуються для цього.

Вони не надто відрізняються за своїми якостями, тому насправді це справа смаку, який з них використовувати. Обидва також мають відкритий вихідний код, тому вони ідеально вписуються в архітектуру CoMPAS.

Ми вирішили використовувати RDF4J, тому що він має багато прикладів в [PowSyBl](https://github.com/powsybl/powsybl-core) і має чудову та активну [спільноту](https://github.com/eclipse/rdf4j).

### Вихідні SCL-файли
Для вихідного SCL-файлу у нас вже є Java-моделі для заповнення. Ми генеруємо ці Java-моделі на основі XSD-схем IEC-61859-6 за допомогою інструменту JAXB XJC. Таким чином, єдине, що нам потрібно зробити, це додати дані з моделі RDF4J до моделі IEC 61850-6 SCL. І останнім кроком є "марширування" цієї Java-моделі в XML-файл.

### Маппінг даних RDF4J в SCL Java класи
Сам маппінг виконується за допомогою [Orika] (https://orika-mapper.github.io/orika-docs/). Orika - це Java-боб для маппінгу даних між двома класами, що робить його більш простим.

Маппинг здійснюється між моделлю (оператором) RDF4J та класом SCL.

### Огляд архітектури
![mapping architecture overview](../images/CIM_61850_mapping_architecture_overview.svg)

### Посилання
IEC 61970-301: Common Information Model

IEC 61970-552: Specification of CIMXML
